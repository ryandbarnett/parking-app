<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parking Spot</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <h1>SAIL REALTY Parking</h1>
  <p id="spot-message"></p>
  <div id="parking-visual"></div>

  <!-- Booking Form -->
  <form id="booking-form" style="display: none;">
    <h2>Book This Spot</h2>
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>
    
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required>
    
    <label for="license-plate">License Plate:</label>
    <input type="text" id="license-plate" name="license-plate" required>
    
    <label for="duration">Duration:</label>
    <select id="duration" name="duration" required>
      <option value="1 hour">1 Hour</option>
      <option value="2 hours">2 Hours</option>
      <option value="3 hours">3 Hours</option>
    </select>
    
    <button type="submit">Confirm Booking</button>
  </form>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const spotId = params.get("spot");
      const bookings = JSON.parse(localStorage.getItem("bookings")) || {};

      const spotMessage = document.getElementById("spot-message");
      const bookingForm = document.getElementById("booking-form");
      const parkingVisual = document.getElementById("parking-visual");

      // Render parking spots
      const totalSpots = 3; // Adjust based on the number of parking spots
      for (let i = 1; i <= totalSpots; i++) {
        const spotDiv = document.createElement("div");
        spotDiv.className = "spot";
        spotDiv.textContent = `Spot ${i}`;

        // Highlight the selected spot
        if (i == spotId) {
          spotDiv.style.backgroundColor = "yellow";
        } else {
          spotDiv.style.backgroundColor = bookings[i] ? "red" : "lightgray"; // Red for booked, light gray for available
        }

        parkingVisual.appendChild(spotDiv);
      }

      // Update the spot message and form visibility
      if (!spotId || spotId < 1 || spotId > totalSpots) {
        spotMessage.textContent = "Invalid spot. Please select a valid spot.";
        bookingForm.style.display = "none";
        return;
      }

      if (bookings[spotId]) {
        spotMessage.textContent = `Spot ${spotId} is already booked by ${bookings[spotId].name} for ${bookings[spotId].duration}.`;
        bookingForm.style.display = "none";
      } else {
        spotMessage.textContent = `Spot ${spotId} is available.`;
        bookingForm.style.display = "block";

        // Handle form submission
        bookingForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const duration = document.getElementById("duration").value;

          bookings[spotId] = { name, email, duration };
          localStorage.setItem("bookings", JSON.stringify(bookings));
          alert(`Spot ${spotId} booked successfully for ${duration}!`);
          window.location.reload();
        });
      }
    });
  </script>
</body>
</html>